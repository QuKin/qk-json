;class QKJson{constructor(json=[]){this.set(json);this.data=[];this.whereTF=false};set(json){if(typeof json==='string'){if(json.indexOf('.json')===-1){this.json=JSON.parse(json)}else{console.log('请使用node版本才能导入json文件')}}else{this.json=json}return this};get(length=0){if(length===0){if(!this.whereTF)return this.json;return this.data}else{if(!this.whereTF)return this.json.splice(0,length);return this.data.splice(0,length)}};first(){if(!this.whereTF){if(this.json.length>0)return this.json[0];return[]}else{if(this.data.length>0)return this.data[0];return[]}};last(){if(!this.whereTF){if(this.json.length>0)return this.json[this.json.length-1];return[]}else{if(this.data.length>0)return this.data[this.data.length-1];return[]}};pagination(pages=0,length=6){pages=pages*length;this.limit(pages,length);return this};limit(start=0,end=6){if(!this.whereTF){this.json=this.json.splice(start,end)}else{this.data=this.data.splice(start,end)}return this};select(key,num=0){if(!this.whereTF){this.json=this.json[num][key]}else{this.data=this.data[num][key]}return this};eq(num){if(!this.whereTF){if(this.json.length>num)this.json=this.json[num]}else{if(this.data.length>num)this.data=this.data[num]}return this};whereAll(arr,join='&&'){this.whereTF=true;let temp=[];let tempArr=[];for(let i=0;i<arr.length;i++){if(arr[i].length==2){temp.push([arr[i][0],'==',arr[i][1]])}else{temp.push([arr[i][0],arr[i][1],arr[i][2]])}}this.json.forEach((value)=>{let ifEval='',a=null,b=null;for(const item of temp){a=!isNaN(Number(value[item[0]]))?parseInt(value[item[0]]):'"'+value[item[0]]+'"';b=!isNaN(Number(item[2]))?parseInt(item[2]):'"'+item[2]+'"';ifEval+=a+item[1]+b+' '+join+' '}ifEval=ifEval.substring(0,ifEval.length-4);if(eval(ifEval)){tempArr.push(value)}});this.data=tempArr;return this};where(obj1,obj2=null,obj3=null){let arr=[];if(!this.whereTF)arr=this.json;else arr=this.data;this.whereTF=true;switch(arguments.length){case 1:this.data=arr.filter(obj1);break;case 2:this.data=arr.filter((item)=>{return item[obj1]==obj2});break;case 3:this.data=arr.filter((item)=>{switch(obj2){case'===':return item[obj1]===obj3;case'<':return item[obj1]<obj3;case'>':return item[obj1]>obj3;case'<=':return item[obj1]<=obj3;case'>=':return item[obj1]>=obj3;case'!=':return item[obj1]!=obj3;case'!==':return item[obj1]!==obj3;default:return item[obj1]==obj3}});break}return this};whereD(key,value){this.whereTF=true;let arr=[];if(!this.whereTF)arr=this.json;else arr=this.data;this.data=arr.filter((item)=>{return item[key]==value});return this};whereS(key,symbol,value){this.whereTF=true;let arr=[];if(!this.whereTF)arr=this.json;else arr=this.data;this.data=arr.filter((item)=>{switch(symbol){case'===':return item[key]===value;case'<':return item[key]<value;case'>':return item[key]>value;case'<=':return item[key]<=value;case'>=':return item[key]>=value;case'!=':return item[key]!=value;case'!==':return item[key]!==value;default:return item[key]==value}});return this};whereC(callback){this.whereTF=true;let arr=[];if(!this.whereTF)arr=this.json;else arr=this.data;this.data=arr.filter(callback);return this};insert(json){if(!this.whereTF)this.json.push(json);else this.data.push(json);return this};insertKey(key,value=null){if(!this.whereTF){for(let i=0;i<this.json.length;i++)this.json[i][key]=value}else{for(let i=0;i<this.data.length;i++)this.data[i][key]=value}return this};update(key,value=null){if(!this.whereTF){for(let i=0;i<this.json.length;i++)this.json[i][key]=value}else{for(let i=0;i<this.data.length;i++)this.data[i][key]=value}return this};delete(){if(!this.whereTF){this.json=[]}else{this.findDelete(this.json,[]);this.data=[]}return this.json};findDelete(json,path){for(const i in json){if(json[i]!=null&&typeof(json[i])=="object")this.findDelete(json[i],path.concat(i));for(let j=0;j<this.data.length;j++){if(JSON.stringify(json[i])==JSON.stringify(this.data[j])){let temp='this.json';for(let o=0;o<path.length;o++){temp+='["'+path[o]+'"]'}eval(temp).splice(i,1)}}}};deleteKey(key){if(!this.whereTF){for(let i=0;i<this.json.length;i++)delete this.json[i][key]}else{for(let i=0;i<this.data.length;i++)delete this.data[i][key]}return this};deleteKey(key){if(!this.whereTF){for(let i=0;i<this.json.length;i++)delete this.json[i][key]}else{for(let i=0;i<this.data.length;i++)delete this.data[i][key]}return this};equal(objA,objB){function isObj(c){return c&&typeof(c)=='object'&&Object.prototype.toString.call(c).toLowerCase()=="[object object]"}function isArray(c){return c&&typeof(c)=='object'&&c.constructor==Array}if(!isObj(objA)||!isObj(objB))return false;if(objA.length!=objB.length)return false;return CompareObj(objA,objB,true);function CompareObj(c,f,d){for(var e in c){if(!d)break;if(!f.hasOwnProperty(e)){d=false;break}if(!isArray(c[e])){if(f[e]!=c[e]){d=false;break}}else{if(!isArray(f[e])){d=false;break}var g=c[e],h=f[e];if(g.length!=h.length){d=false;break}for(var l in g){if(!d)break;d=CompareObj(g[l],h[l],d)}}}return d}};orderBy(parameters,type='asc'){if(typeof parameters=='string')parameters=[parameters];function main(d,e){let pop=e.pop();d.sort(function(c,f){let convertA=c[pop];let convertB=f[pop];if(typeof convertA=='string'&&typeof convertB=='string'){if(type=='asc')return convertA.localeCompare(convertB);return convertB.localeCompare(convertA)}else{if(type=='asc')return convertA-convertB;return convertB-convertA}});if(e.length!=0){main(d,e)}}if(!this.whereTF)main(this.json,parameters);else main(this.data,parameters);return this};domImport(self){const file=self.files[0];if(!!file){const reader=new FileReader();reader.readAsText(file);reader.onload=function(){this.json=JSON.parse(this.result)}}};domExport(filename='json'){let data=[];if(!this.whereTF)data=this.json;else data=this.data;if(typeof data==="object"){data=JSON.stringify(data,undefined,4)}let blob=new Blob([data],{type:"text/json"}),a=document.createElement("a");a.download=filename+'.json';a.href=window.URL.createObjectURL(blob);a.dataset.downloadurl=["text/json",a.download,a.href].join(":");let event=new MouseEvent("click",{});a.dispatchEvent(event)};innerJoin(json,key){this.whereTF=true;this.data=[];let keys=[...new Set(Object.keys(this.json[0]).concat(Object.keys(json[0])))];for(let i=0;i<this.json.length;i++){for(let j=0;j<json.length;j++){if(typeof key==='string'){if(this.json[i][key]===json[j][key]){let temp={};for(let o=0;o<keys.length;o++){temp[keys[o]]=this.json[i][keys[o]]===undefined?json[j][keys[o]]:this.json[i][keys[o]]}this.data.push(temp)}}else if(typeof key==='object'){let ifEval='';for(let k=0;k<key.length;k++){ifEval+='this.json[i]["'+key[k]+'"]===json[j]["'+key[k]+'"] && '}ifEval+='1===1';if(eval(ifEval)){let temp={};for(let o=0;o<keys.length;o++){temp[keys[o]]=this.json[i][keys[o]]===undefined?json[j][keys[o]]:this.json[i][keys[o]]}this.data.push(temp)}}}}return this};leftJoin(json,key){this.whereTF=true;this.data=[];let keys=[...new Set(Object.keys(this.json[0]).concat(Object.keys(json[0])))];for(let i=0;i<this.json.length;i++){let temp={};for(let j=0;j<json.length;j++){if(typeof key==='string'){if(this.json[i][key]===json[j][key]){for(let o=0;o<keys.length;o++){temp[keys[o]]=this.json[i][keys[o]]===undefined?json[j][keys[o]]:this.json[i][keys[o]]}break}else{for(let o=0;o<keys.length;o++){temp[keys[o]]=this.json[i][keys[o]]===undefined?null:this.json[i][keys[o]]}}}else if(typeof key==='object'){let ifEval='';for(let k=0;k<key.length;k++){ifEval+='this.json[i]["'+key[k]+'"]===json[j]["'+key[k]+'"] && '}ifEval+='1===1';if(eval(ifEval)){for(let o=0;o<keys.length;o++){temp[keys[o]]=this.json[i][keys[o]]===undefined?json[j][keys[o]]:this.json[i][keys[o]]}break}else{for(let o=0;o<keys.length;o++){temp[keys[o]]=this.json[i][keys[o]]===undefined?null:this.json[i][keys[o]]}}}}this.data.push(temp)}return this};rightJoin(json,key){this.whereTF=true;this.data=[];let keys=[...new Set(Object.keys(this.json[0]).concat(Object.keys(json[0])))];for(let i=0;i<json.length;i++){let temp={};for(let j=0;j<this.json.length;j++){if(typeof key==='string'){if(json[i][key]===this.json[j][key]){for(let o=0;o<keys.length;o++){temp[keys[o]]=json[i][keys[o]]===undefined?this.json[j][keys[o]]:json[i][keys[o]]}break}else{for(let o=0;o<keys.length;o++){temp[keys[o]]=json[i][keys[o]]===undefined?null:json[i][keys[o]]}}}else if(typeof key==='object'){let ifEval='';for(let k=0;k<key.length;k++){ifEval+='json[i]["'+key[k]+'"]===this.json[j]["'+key[k]+'"] && '}ifEval+='1===1';if(eval(ifEval)){for(let o=0;o<keys.length;o++){temp[keys[o]]=json[i][keys[o]]===undefined?this.json[j][keys[o]]:json[i][keys[o]]}break}else{for(let o=0;o<keys.length;o++){temp[keys[o]]=json[i][keys[o]]===undefined?null:json[i][keys[o]]}}}}this.data.push(temp)}return this};fullJoin(json,key){this.whereTF=true;this.data=[];let temp=[];this.leftJoin(json,key);temp.push(...this.data);this.rightJoin(json,key);temp.push(...this.data);temp=this.unRepeat(temp,key);this.data=temp;return this};unRepeat(arr,key){const res=new Map();return arr.filter((arr)=>!res.has(arr[key])&&res.set(arr[key],1))};clear(){this.whereTF=false;this.data=[];return this};close(){this.json=[];this.data=[];this.whereTF=[];return true}};